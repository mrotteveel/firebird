#
# Makefile for BtYacc.
#

VERSION       = 3-0

DEST	      = .

HDRS	      = defs.h mstring.h

# Keep this as simple as possible. It's desirable that btyacc be portable
# across all of our supported compilers/platforms.

# Vanilla CFLAGS
CFLAGS=

# No LDFLAGS
#LDFLAGS=

LIBS=

# For GNU environment, gmake will set $CC to gcc
# Other environments will have different values, maybe no GNU installed!
#CC	      = gcc

MAKEFILE      = Makefile

OBJ_DIR       = ../../temp/extern/btyacc

all: $(PROGRAM)

OBJS	      = $(OBJ_DIR)/closure.o $(OBJ_DIR)/error.o $(OBJ_DIR)/lalr.o \
		$(OBJ_DIR)/lr0.o $(OBJ_DIR)/main.o $(OBJ_DIR)/mkpar.o $(OBJ_DIR)/output.o \
		$(OBJ_DIR)/mstring.o $(OBJ_DIR)/reader.o $(OBJ_DIR)/readskel.o \
		$(OBJ_DIR)/skeleton.o $(OBJ_DIR)/symtab.o $(OBJ_DIR)/verbose.o \
		$(OBJ_DIR)/warshall.o

$(OBJ_DIR)/%.o: %.c
	$(CC) $(CFLAGS) -c $< -o $@

$(OBJS): | $(OBJ_DIR)

$(OBJ_DIR):
	mkdir -p $(OBJ_DIR)

PRINT	      = pr -f -l88

PROGRAM	      = ../../gen/extern/btyacc/btyacc

SRCS	      = closure.c error.c lalr.c lr0.c main.c mkpar.c output.c	\
		mstring.c reader.c readskel.c skeleton.c symtab.c verbose.c warshall.c

OTHERS	      = README README.BYACC \
		Makefile btyaccpa.ske push.skel empty.y skel2c manpage makefile.dos \
		skeleton.c

all:		$(PROGRAM)

$(PROGRAM):     $(OBJS) $(LIBS)
		mkdir -p $(dir $(PROGRAM))
		$(CC) $(LDFLAGS) -o $(PROGRAM) $(OBJS) $(LIBS)

clean:;		rm -f $(OBJS)

clobber:;	rm -f $(OBJS) $(PROGRAM)

distclean:;	rm -f $(OBJS) $(PROGRAM) *.zip *.gz

depend:;	mkmf -f $(MAKEFILE) PROGRAM=$(PROGRAM) DEST=$(DEST)

index:;		ctags -wx $(HDRS) $(SRCS)

install:	$(PROGRAM)
		cp $(PROGRAM).exe /bin

oldinstall:	$(PROGRAM)
		@echo Installing $(PROGRAM) in $(DEST)
		install -s $(PROGRAM) $(DEST)

listing:;	$(PRINT) Makefile $(HDRS) $(SRCS) | lpr

lint:;		lint $(SRCS)

program:        $(PROGRAM)

tags:           $(HDRS) $(SRCS)
		ctags $(HDRS) $(SRCS)

dist:		tar zip

tar:
		rm -f btyacc.tar btyacc.tar.gz
		tar cvf btyacc.tar $(OTHERS) $(SRCS) $(HDRS) test/*.y
		gzip -9 btyacc.tar
		mv btyacc.tar.gz btyacc-$(VERSION).tar.gz

zip:
		zip btyacc.zip $(OTHERS) $(SRCS) $(HDRS) test/*.y
		mv btyacc.zip btyacc-$(VERSION).zip

# skeleton.c now stored in CVS, not generated by build
#skeleton.c: btyaccpa.ske skel2c
#		awk -f skel2c btyaccpa.ske >skeleton.c

etags TAGS:
		etags *.c *.h

###
$(OBJ_DIR)/closure.o: defs.h
$(OBJ_DIR)/error.o: defs.h
$(OBJ_DIR)/lalr.o: defs.h
$(OBJ_DIR)/lr0.o: defs.h
$(OBJ_DIR)/main.o: defs.h
$(OBJ_DIR)/mkpar.o: defs.h
$(OBJ_DIR)/mstring.o: mstring.h
$(OBJ_DIR)/output.o: defs.h
$(OBJ_DIR)/reader.o: defs.h mstring.h
$(OBJ_DIR)/skeleton.o: defs.h
$(OBJ_DIR)/symtab.o: defs.h
$(OBJ_DIR)/verbose.o: defs.h
$(OBJ_DIR)/warshall.o: defs.h


